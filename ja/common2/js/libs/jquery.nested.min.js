(function(c,b){var a=function(g,d,e){var h;return function f(){var k=this,j=arguments;
function i(){if(!e){g.apply(k,j)}h=null}if(h){clearTimeout(h)}else{if(e){g.apply(k,j)
}}h=setTimeout(i,d||150)}};jQuery.fn[b]=function(d){return d?this.bind("resize",a(d)):this.trigger(b)
}})(jQuery,"smartresize");if(!Object.keys){Object.keys=function(c){var b=[],a;for(a in c){if(Object.prototype.hasOwnProperty.call(c,a)){b.push(a)
}}return b}}(function(b){b.Nested=function(c,d){this.element=b(d);this._init(c)};
b.Nested.settings={selector:".box",minWidth:50,minColumns:1,gutter:1,centered:false,resizeToFit:true,resizeToFitOptions:{resizeAny:true},animate:true,animationOptions:{speed:20,duration:100,queue:true,complete:function(){}}};
b.Nested.prototype={_init:function(d){var c=this;this.box=this.element;b(this.box).css("position","relative");
this.options=b.extend(true,{},b.Nested.settings,d);this.elements=[];this._isResizing=false;
this._update=true;this.maxy=new Array();b(window).smartresize(function(){c.resize()
});this._setBoxes()},_setBoxes:function(f,i){var c=this;this.idCounter=0;this.counter=0;
this.t=0;this.maxHeight=0;this.currWidth=0;this.total=this.box.find(this.options.selector);
this.matrix={};this.gridrow=new Object;var e=!this.options.centered?this.box.innerWidth():b(window).width();
this.columns=Math.max(this.options.minColumns,parseInt(e/(this.options.minWidth+this.options.gutter))+1);
var d=this.options.minWidth;var h=this.options.gutter;var g="block";f=this.box.find(this.options.selector);
b.each(f,function(){var m=parseInt(b(this).attr("class").replace(/^.*size([0-9]+).*$/,"$1")).toString().split("");
var k=(m[0]=="N")?1:parseFloat(m[0]);var n=(m[1]=="a")?1:parseFloat(m[1]);var j=d*k+h*(k-1);
var l=d*n+h*(n-1);b(this).css({display:g,position:"absolute",width:j,height:l,top:b(this).position().top,left:b(this).position().left}).removeClass("nested-moved").attr("data-box",c.idCounter).attr("data-width",j);
c.idCounter++;c._renderGrid(b(this),i)});if(c.counter==c.total.length){if(c.options.resizeToFit){c.elements=c._fillGaps()
}c._renderItems(c.elements);c.elements=[]}},_addMatrixRow:function(f){if(this.matrix[f]){return false
}else{this.matrix[f]={}}for(var e=0;e<(this.columns-1);e++){var d=e*(this.options.minWidth+this.options.gutter);
this.matrix[f][d]="false"}},_updateMatrix:function(j){var d=0;var g=parseInt(j.y);
var f=parseInt(j.x);for(var i=0;i<j.height;i+=(this.options.minWidth+this.options.gutter)){for(var e=0;
e<j.width;e+=(this.options.minWidth+this.options.gutter)){var c=f+e;var k=g+i;if(!this.matrix[k]){this._addMatrixRow(k)
}this.matrix[k][c]="true"}}},_getObjectSize:function(d){var c=0;b.each(d,function(f,e){c++
});return c},_fillGaps:function(){var e=this;var g={};b.each(this.elements,function(i,j){e._updateMatrix(j)
});var c=this.elements;c.sort(function(j,i){return j.y-i.y});c.reverse();var d=c[0]["y"];
var h=0;var f=this._getObjectSize(this.matrix);b.each(this.matrix,function(j,i){f--;
h=parseInt(j);b.each(i,function(k,l){if(l==="false"&&h<d){if(!g.y){g.y=j}if(!g.x){g.x=k
}if(!g.w){g.w=0}if(!g.h){g.h=e.options.minWidth}g.w+=(g.w)?(e.options.minWidth+e.options.gutter):e.options.minWidth;
var o=0;for(var n=1;n<f;n++){var m=parseInt(j)+parseInt(n*(e.options.minWidth+e.options.gutter));
if(e.matrix[m]&&e.matrix[m][k]=="false"){o+=(e.options.minWidth+e.options.gutter);
e.matrix[m][k]="true"}else{break}}g.h+(parseInt(o)/(e.options.minWidth+e.options.gutter)==f)?0:parseInt(o);
g.ready=true}else{if(g.ready){b.each(c,function(p,q){if(g.y<=c[p]["y"]&&(e.options.resizeToFitOptions.resizeAny||g.w<=c[p]["width"]&&g.h<=c[p]["height"])){c.splice(p,1);
b(q["$el"]).addClass("nested-moved");e.elements.push({$el:b(q["$el"]),x:parseInt(g.x),y:parseInt(g.y),col:p,width:parseInt(g.w),height:parseInt(g.h)});
return false}});g={}}}})});e.elements=c;return e.elements},_renderGrid:function(d,c){this.counter++;
var g,e=g=0;var j=0;var m=!c?"append":"prepend";var f=d.width();var o=d.height();
var h=Math.ceil(f/(this.options.minWidth+this.options.gutter));var p=Math.ceil(o/(this.options.minWidth+this.options.gutter));
if(h>this.options.minColumns){this.options.minColumns=h}while(true){for(var k=h;k>=0;
k--){if(this.gridrow[e+k]){break}this.gridrow[e+k]=new Object;for(var l=0;l<this.columns;
l++){this.gridrow[e+k][l]=false}}for(var i=0;i<(this.columns-h);i++){matrixY=e*(this.options.minWidth+this.options.gutter);
this._addMatrixRow(matrixY);var n=true;for(var k=0;k<p;k++){for(var l=0;l<h;l++){if(!this.gridrow[e+k]){break
}if(this.gridrow[e+k][i+l]){n=false;break}}if(!n){break}}if(n){for(var k=0;k<p;k++){for(var l=0;
l<h;l++){if(!this.gridrow[e+k]){break}this.gridrow[e+k][i+l]=true}}this._pushItem(d,i*(this.options.minWidth+this.options.gutter),e*(this.options.minWidth+this.options.gutter),f,o,h,p,m);
return}}e++}},_pushItem:function(e,c,k,d,f,i,g,j){if(j=="prepend"){this.elements.unshift({$el:e,x:c,y:k,width:d,height:f,cols:i,rows:g})
}else{this.elements.push({$el:e,x:c,y:k,width:d,height:f,cols:i,rows:g})}},_setHeight:function(d){var c=this;
b.each(d,function(f,g){var e=(g.y+g.height);if(e>c.maxHeight){c.maxHeight=e}});return c.maxHeight
},_setWidth:function(d){var c=this;b.each(d,function(f,g){var e=(g.x+g.width);if(e>c.currWidth){c.currWidth=e
}});return c.currWidth},_renderItems:function(m){var l=this;this.box.css("height",this._setHeight(m));
if(this.options.centered){this.box.css({width:this._setWidth(m),"margin-left":"auto","margin-right":"auto"})
}m.reverse();var e=this.options.animationOptions.speed;var n=this.options.animationOptions.effect;
var f=this.options.animationOptions.duration;var h=this.options.animationOptions.queue;
var c=this.options.animate;var d=this.options.animationOptions.complete;var k=this;
var g=0;var j=0;b.each(m,function(i,o){$currLeft=b(o["$el"]).position().left;$currTop=b(o["$el"]).position().top;
$currWidth=b(o["$el"]).width();$currHeight=b(o["$el"]).width();o["$el"].attr("data-y",$currTop).attr("data-x",$currLeft);
if(c&&h&&($currLeft!=o.x||$currTop!=o.y)){setTimeout(function(){o["$el"].css({display:"block",width:o.width,height:o.height}).animate({left:o.x,top:o.y},f);
j++;if(j==g){d.call(undefined,m)}},g*e);g++}if(c&&!h&&($currLeft!=o.x||$currTop!=o.y)){setTimeout(function(){o["$el"].css({display:"block",width:o.width,height:o.height}).animate({left:o.x,top:o.y},f);
j++;if(j==g){d.call(undefined,m)}},g);g++}if(!c&&($currLeft!=o.x||$currTop!=o.y)){o["$el"].css({display:"block",width:o.width,height:o.height,left:o.x,top:o.y});
j++;if(j==g){d.call(undefined,m)}}});if(g==0){d.call(undefined,m)}},append:function(c){this._isResizing=true;
this._setBoxes(c,"append");this._isResizing=false},prepend:function(c){this._isResizing=true;
this._setBoxes(c,"prepend");this._isResizing=false},resize:function(c){if(Object.keys(this.matrix[0]).length%Math.floor(this.element.width()/(this.options.minWidth+this.options.gutter))>0){this._isResizing=true;
this._setBoxes(this.box.find(this.options.selector));this._isResizing=false}},refresh:function(c){c=c||this.options;
this.options=b.extend(true,{},b.Nested.settings,c);this.elements=[];this._isResizing=false;
this._setBoxes()},destroy:function(){var c=this;b(window).unbind("resize",function(){c.resize()
});$els=this.box.find(this.options.selector);b($els).removeClass("nested-moved").removeAttr("style data-box data-width data-x data-y").removeData();
this.box.removeAttr("style").removeData()}};var a={refresh:function(c){return this.each(function(){var d=b(this);
var e=d.data("nested");e.refresh(c)})},destroy:function(){return this.each(function(){var c=b(this);
var d=c.data("nested");d.destroy()})}};b.fn.nested=function(c,d){if(a[c]){return a[c].apply(this,Array.prototype.slice.call(arguments,1))
}if(typeof c==="string"){this.each(function(){var e=b.data(this,"nested");e[c].apply(e,[d])
})}else{this.each(function(){b.data(this,"nested",new b.Nested(c,this))})}return this
}})(jQuery);